# AWS Security Baseline Deployment Wizard

A Python CLI wizard for configuring and deploying the AWS Security Baseline
Terraform modules. The wizard provides an interactive experience for selecting
security services, configuring AWS settings, and generating Terraform
configuration files.

## Features

- Interactive terminal UI with colored output
- Support for 8 AWS security services
- Region and environment configuration
- Custom resource tagging
- Non-interactive mode for automation
- Generates ready-to-use `terraform.tfvars` files

## Installation

### Prerequisites

- Python 3.9 or higher

### Install Dependencies

Create a virtual environment and install the required packages:

```bash
# Create virtual environment
python3 -m venv wizard/.venv

# Activate it
source wizard/.venv/bin/activate

# Install dependencies
pip install -r wizard/requirements.txt
```

After installation, run the wizard with:

```bash
source wizard/.venv/bin/activate  # if not already activated
python wizard.py
```

The wizard requires the following Python packages:

- `rich>=13.0.0` - Terminal formatting and interactive prompts
- `hypothesis>=6.0.0` - Property-based testing (development only)
- `pytest>=7.0.0` - Test framework (development only)

## Usage

### Interactive Mode

Run the wizard without arguments for a guided configuration experience:

```bash
python wizard.py
```

The wizard will guide you through:

1. **Module Selection** - Choose which AWS security services to enable
2. **Region Configuration** - Select the AWS region for deployment
3. **Environment Configuration** - Set the environment name (dev, staging, prod)
4. **Tag Configuration** - Add custom resource tags
5. **Summary & Confirmation** - Review and confirm your configuration

### Non-Interactive Mode

For automation and scripting, use command-line arguments:

```bash
# Enable all modules with default settings
python wizard.py --all-modules

# Specify region and environment
python wizard.py --all-modules --region us-west-2 --env production

# Add custom tags
python wizard.py --all-modules --region eu-west-1 --env staging \
  --tag Project=Security --tag Team=DevOps

# View help
python wizard.py --help
```

### Command-Line Options

| Option            | Description                     | Example               |
| ----------------- | ------------------------------- | --------------------- |
| `--all-modules`   | Enable all 8 security modules   | `--all-modules`       |
| `--region REGION` | AWS region (default: us-east-1) | `--region eu-west-1`  |
| `--env ENV`       | Environment name                | `--env production`    |
| `--tag KEY=VALUE` | Add a resource tag              | `--tag Project=MyApp` |
| `--help`          | Display usage information       | `--help`              |

## Available Security Modules

The wizard supports configuration of the following AWS security services:

| Module              | Description                   |
| ------------------- | ----------------------------- |
| CloudTrail          | API logging and audit trail   |
| AWS Config          | Configuration change tracking |
| GuardDuty           | Threat detection service      |
| Detective           | Security investigation        |
| Security Hub        | Central security dashboard    |
| IAM Access Analyzer | External access analysis      |
| Inspector           | Vulnerability scanning        |
| Macie               | Sensitive data discovery      |

## Example Commands

### Basic Deployment

```bash
# Interactive mode - follow the prompts
python wizard.py
```

### Full Deployment with All Modules

```bash
# Deploy all security services to us-east-1
python wizard.py --all-modules --env prod
```

### Custom Region Deployment

```bash
# Deploy to EU region with staging environment
python wizard.py --all-modules --region eu-central-1 --env staging
```

### Deployment with Custom Tags

```bash
# Add project and cost center tags
python wizard.py --all-modules \
  --region us-west-2 \
  --env production \
  --tag Project=SecurityBaseline \
  --tag CostCenter=IT-Security \
  --tag Owner=security-team
```

### CI/CD Pipeline Example

```bash
# Non-interactive deployment for automation
python wizard.py \
  --all-modules \
  --region ${AWS_REGION} \
  --env ${ENVIRONMENT} \
  --tag Pipeline=GitHub-Actions \
  --tag BuildNumber=${BUILD_NUMBER}
```

## Output

The wizard generates a `terraform.tfvars` file in the project root with your
configuration:

```hcl
# AWS Security Baseline Configuration
# Generated by Deployment Wizard

# AWS Region
aws_region = "us-east-1"

# Environment
env = "production"

# Module Enable Flags
enable_cloudtrail     = true
enable_config         = true
enable_guardduty      = true
enable_detective      = true
enable_securityhub    = true
enable_accessanalyzer = true
enable_inspector      = true
enable_macie          = true

# Resource Tags
tags = {
  Environment = "production"
  ManagedBy   = "Terraform"
  Project     = "SecurityBaseline"
}
```

## Next Steps After Configuration

After running the wizard, deploy the infrastructure:

### Step 1: Configure AWS Credentials

```bash
# Option 1: AWS CLI
aws configure

# Option 2: Environment variables
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
```

### Step 2: Initialize Terraform

```bash
terraform init
```

### Step 3: Preview Changes

```bash
terraform plan
```

### Step 4: Apply Configuration

```bash
terraform apply
```

## Validation

The wizard validates all inputs:

- **Region**: Must match AWS region format (e.g., `us-east-1`, `eu-west-1`)
- **Environment**: Only alphanumeric characters and hyphens allowed
- **Tags**: Keys cannot be empty

Invalid inputs will display an error message and prompt for correction.

## Auto-Generated Tags

The wizard automatically includes these tags on all resources:

| Tag           | Value                           |
| ------------- | ------------------------------- |
| `Environment` | Your specified environment name |
| `ManagedBy`   | `Terraform`                     |

Additional custom tags can be added during configuration.

## Troubleshooting

### Missing Dependencies

```text
Required package 'rich' not found. Install with: pip install rich
```

**Solution**: Install the required packages:

```bash
pip install -r wizard/requirements.txt
```

### Invalid Region Format

```text
Invalid region format: 'invalid'. Expected format: us-east-1
```

**Solution**: Use a valid AWS region code (e.g., `us-east-1`, `eu-west-1`)

### Invalid Environment Name

```text
Invalid environment name: 'my env'. Use only letters, numbers, and hyphens.
```

**Solution**: Use only alphanumeric characters and hyphens (e.g., `dev`,
`staging`, `prod-us`)

### File Permission Error

```text
Failed to write terraform.tfvars: Permission denied
```

**Solution**: Check write permissions for the project directory

## Development

### Running Tests

```bash
cd wizard
pytest -v
```

### Project Structure

```text
wizard/
├── __init__.py       # Package initialization
├── cli.py            # Command-line argument parsing
├── display.py        # Terminal UI components
├── generator.py      # tfvars file generation
├── main.py           # Main entry point and orchestration
├── models.py         # Data models and module registry
├── prompts.py        # Interactive prompts
├── validators.py     # Input validation functions
├── requirements.txt  # Python dependencies
├── README.md         # This documentation
└── test_*.py         # Test files
```

## Links

- **Repository**:
  [aws-security-baseline](https://github.com/jsredmond/aws-security-baseline)
- **Issues**:
  [Report an issue](https://github.com/jsredmond/aws-security-baseline/issues)
